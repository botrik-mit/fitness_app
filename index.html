<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="–ü–ª–∞–Ω —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∏ –ø–∏—Ç–∞–Ω–∏—è –Ω–∞ 12 –Ω–µ–¥–µ–ª—å" />
<meta name="theme-color" content="#4a7dff" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="apple-mobile-web-app-title" content="–ü–ª–∞–Ω –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫" />
<link rel="apple-touch-icon" href="icon/apple-touch-icon.png">
<link rel="manifest" href="manifest.json">
<title>–ü–ª–∞–Ω –†–æ—Å—Ç–∞ –∏ –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</title>

<!-- Supabase JS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
  :root {
    --bg: #f5f5f5;
    --fg: #222;
    --card: #ffffff;
    --day-bg: #eef4ff;
    --accent: #4a7dff;
  }
  body.dark {
    --bg: #0e0e0e;
    --fg: #e0e0e0;
    --card: #1a1a1a;
    --day-bg: #232323;
    --accent: #729dff;
  }
  
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    margin: 0;
    padding: 20px;
    background: var(--bg);
    color: var(--fg);
    transition: 0.3s;
    font-size: 16px;
    line-height: 1.5;
  }
  
  /* AUTH SCREEN */
  #authScreen {
    max-width: 400px;
    margin: 100px auto;
    text-align: center;
    background: var(--card);
    padding: 40px;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  }
  
  #authScreen h1 {
    margin-bottom: 30px;
    color: var(--accent);
  }
  
  #loginBtn {
    background: var(--accent);
    color: white;
    border: none;
    padding: 15px 30px;
    border-radius: 10px;
    font-size: 1em;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(74, 125, 255, 0.3);
    transition: 0.2s;
  }
  
  #loginBtn:hover {
    opacity: 0.9;
    transform: translateY(-2px);
  }
  
  #appContainer {
    display: none;
  }
  
  nav { margin:20px auto; max-width:900px; display:flex; gap:8px; flex-wrap:wrap; justify-content:center;
    background:var(--card); padding:10px; border-radius:12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
  nav button { padding:8px 12px; border-radius:10px; border:1px solid rgba(128,128,128,0.2); background:var(--card);
    color:var(--fg); cursor:pointer; font-size: 0.9em; transition: 0.2s; font-weight: 500; }
  nav button:active { background: var(--accent); color: white; border-color: var(--accent); }
  
  .container { max-width: 900px; margin: auto; background: var(--card); padding: 25px;
    border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); display:none; }
  #training { display:block; }
  
  .next-week-btn {
    padding: 10px 20px; margin-bottom: 20px; border-radius: 10px; border: none;
    background: var(--accent); color: white; cursor: pointer; font-size: 0.95em; font-weight: 600;
    box-shadow: 0 4px 12px rgba(74, 125, 255, 0.3);
  }
  
  .day { background: var(--day-bg); padding:15px; margin-bottom:15px; border-radius:12px; border: 1px solid rgba(128,128,128,0.05); }
  input[type="checkbox"] { width: 20px; height: 20px; margin-right:12px; cursor: pointer; accent-color: var(--accent); }
  
  .progress-container { width:100%; background:rgba(128,128,128,0.2); border-radius:10px; margin:15px 0; height: 10px; overflow: hidden; }
  .progress-bar { height:100%; background:var(--accent); width:0%; transition:0.4s; }
  
  .exercise-row { display: flex; justify-content: space-between; align-items: center; margin: 12px 0; gap: 10px; }
  .exercise-left { flex: 1; display: flex; align-items: center; font-weight: 500; }
  .exercise-right { display: flex; align-items: center; gap: 8px; }
  
  .weight-input { width: 65px; padding: 6px 8px; border: 1px solid rgba(128,128,128,0.3); border-radius: 8px;
    font-size: 0.9em; background: var(--bg); color: var(--fg); text-align: center; }
  .last-weight { font-size: 0.8em; color: #888; min-width: 50px; }
  
  .rpe-select { padding: 5px; border-radius: 8px; font-size: 0.85em; border: 1px solid rgba(128,128,128,0.3); background: var(--bg); color: var(--fg); }
  .comment-btn { border: none; background: rgba(128,128,128,0.1); cursor: pointer; font-size: 1em; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; position: relative; }
  .comment-star { position: absolute; top: -2px; right: -2px; font-size: 0.7em; color: var(--accent); visibility: hidden; }
  
  .editable-list { list-style: none; padding: 0; margin: 10px 0; width: 100%; }
  .editable-item, .exercise-editor-item {
    display: flex; justify-content: space-between; align-items: center;
    background: var(--bg); padding: 12px 15px; margin-bottom: 10px; border-radius: 12px; 
    border: 1px solid rgba(128,128,128,0.1); width: 100%; box-sizing: border-box;
  }
  .editable-item span, .exercise-editor-item span { flex: 1; padding-right: 10px; }
  .editable-item div, .exercise-editor-item div { display: flex; gap: 6px; flex-shrink: 0; }
  .editable-item button, .exercise-editor-item button { 
    cursor: pointer; width: 32px; height: 32px; border-radius: 8px; border: none; 
    display: flex; align-items: center; justify-content: center; font-size: 0.9em; transition: 0.2s;
  }
  .edit-btn { background: #eef4ff; color: #4a7dff; }
  .del-btn { background: #fff1f0; color: #ff4d4f; }
  
  .edit-form { background: var(--card); padding: 20px; border-radius: 16px; margin: 20px 0; border: 1px solid var(--accent); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
  .edit-form label { display: block; margin-top: 12px; font-weight: 600; font-size: 0.9em; opacity: 0.8; }
  .edit-form input, .edit-form select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid rgba(128,128,128,0.2);
    border-radius: 10px; font-size: 1em; background: var(--bg); color: var(--fg); box-sizing: border-box; }
  
  .edit-form .checkbox-wrapper { 
    display: flex; 
    align-items: center; 
    gap: 10px; 
    margin: 15px 0; 
    padding: 10px 0;
  }
  .edit-form .checkbox-wrapper input[type="checkbox"] { 
    width: 20px; 
    height: 20px; 
    margin: 0; 
    cursor: pointer; 
    accent-color: var(--accent);
    flex-shrink: 0;
  }
  .edit-form .checkbox-wrapper label { 
    margin: 0; 
    font-weight: normal; 
    opacity: 1; 
    cursor: pointer;
    flex: 1;
  }
  
  .edit-form .form-buttons { display: flex; gap: 10px; margin-top: 20px; }
  .edit-form .save-btn, .edit-form .cancel-btn { 
    flex: 1; padding: 12px; border-radius: 10px; border: none; 
    font-size: 1em; font-weight: 600; cursor: pointer; transition: 0.2s;
  }
  .edit-form .save-btn { background: var(--accent); color: white; }
  .edit-form .save-btn:hover { opacity: 0.9; }
  .edit-form .cancel-btn { background: rgba(128,128,128,0.15); color: var(--fg); }
  .edit-form .cancel-btn:hover { background: rgba(128,128,128,0.25); }
  
  .day-btn { padding: 8px 15px; border-radius: 10px; border: 1px solid rgba(128,128,128,0.2); background: var(--card); 
    color: var(--fg); cursor: pointer; font-size: 0.85em; transition: 0.2s; font-weight: 500; }
  .day-btn.active { background: var(--accent); color: white; border-color: var(--accent); box-shadow: 0 4px 10px rgba(74, 125, 255, 0.2); }
  
  #daySelector { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 15px; }
  
  hr { border: 0; border-top: 1px solid rgba(128,128,128,0.1); margin: 30px 0; }
  
  .supplement-section { margin-bottom: 25px; }
  .supplement-textarea { width: 100%; min-height: 100px; padding: 12px; border-radius: 8px; border: 1px solid #aaa;
    font-size: 1em; resize: vertical; display: none; background: var(--bg); color: var(--fg); box-sizing: border-box; }
  .supplement-view { white-space: pre-wrap; background: var(--day-bg); padding: 14px; border-radius: 8px; min-height: 50px; }

  /* –ú–û–ë–ò–õ–¨–ù–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø */
  @media (max-width: 768px) {
    body { padding: 10px; font-size: 15px; padding-bottom: 140px; }
    h1 { font-size: 1.5em !important; margin: 15px 0 !important; }
    h2 { font-size: 1.3em !important; margin: 12px 0 !important; }
    
    nav { position: fixed; bottom: 0; left: 0; right: 0; margin: 0; padding: 12px 10px 25px; gap: 8px; border-radius: 24px 24px 0 0;
      box-shadow: 0 -5px 20px rgba(0,0,0,0.15); background: var(--card); z-index: 999; display: grid; grid-template-columns: repeat(3, 1fr); }
    nav button { padding: 10px 5px; font-size: 0.75em; min-height: 44px; border-radius: 12px; }
    
    .container { padding: 15px; margin: 5px auto 140px; border-radius: 24px; }
    .next-week-btn { padding: 14px; font-size: 0.95em; width: 100%; border-radius: 14px; }
    
    .day { padding: 15px; margin-bottom: 12px; }
    input[type="checkbox"] { width: 22px; height: 22px; margin-right: 10px; }
    
    .exercise-row { flex-direction: column; align-items: flex-start; gap: 10px; padding: 5px 0; border-bottom: 1px solid rgba(128,128,128,0.1); }
    .exercise-right { width: 100%; justify-content: space-between; gap: 8px; }
    
    .weight-input { width: 70px !important; min-height: 38px; font-size: 1em !important; }
    .rpe-select { flex: 1; min-height: 38px; font-size: 0.9em; }
    .comment-btn { width: 38px; height: 38px; font-size: 1.2em; }
    
    .editable-item, .exercise-editor-item { padding: 10px !important; }
    .editable-item button, .exercise-editor-item button { width: 36px; height: 36px; font-size: 1em; }
    
    .edit-form { padding: 15px; }
    .edit-form input, .edit-form select { min-height: 44px; font-size: 16px; }
    .edit-form .checkbox-wrapper { margin: 12px 0; gap: 12px; }
    .edit-form .checkbox-wrapper input[type="checkbox"] { width: 24px; height: 24px; min-width: 24px; }
    .edit-form .checkbox-wrapper label { font-size: 16px; }
  }
</style>
</head>
<body>

<!-- AUTH SCREEN -->
<div id="authScreen">
  <h1>üèãÔ∏è –ü–ª–∞–Ω –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h1>
  <p style="font-size: 1.1em; margin: 20px 0; line-height: 1.6;">
    –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –Ω–∞ 12 –Ω–µ–¥–µ–ª—å —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
  </p>
  <button id="loginBtn">–í–æ–π—Ç–∏</button>
  <p style="margin-top: 25px; font-size: 0.95em; color: #666; line-height: 1.6; max-width: 350px; margin-left: auto; margin-right: auto;">
    üí° –ü—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –ª–æ–≥–∏–Ω.<br>
    –û–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –≤–∞–º –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–∏–º —Å –ª—é–±–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.
  </p>
</div>

<!-- APP CONTAINER -->
<div id="appContainer">

<nav>
  <button onclick="showToday()">–°–µ–≥–æ–¥–Ω—è</button>
  <button onclick="showPage('training')">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</button>
  <button onclick="showPage('nutrition')">–ü–∏—Ç–∞–Ω–∏–µ</button>
  <button onclick="showPage('supplements')">–î–æ–±–∞–≤–∫–∏</button>
  <button onclick="showPage('stats')">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
  <button class="toggle-theme" onclick="toggleTheme()">–¢–µ–º–∞</button>
</nav>

<!-- TRAINING -->
<div id="training" class="container">

  <button onclick="nextWeek()" class="next-week-btn">–°–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è</button>
<div id="trainingEditor">

  <h2>–î–Ω–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h2>
  <ul id="daysEditor" class="editable-list"></ul>
  <button id="addDayBtn">+ –î–æ–±–∞–≤–∏—Ç—å –¥–µ–Ω—å</button>
  
  <div id="dayEditForm" class="edit-form">
    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –¥–Ω—è:</label>
    <input type="text" id="dayNameInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫">
    <label>–î–µ–Ω—å –Ω–µ–¥–µ–ª–∏:</label>
    <select id="dayWeekdaySelect">
      <option value="1">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</option>
      <option value="2">–í—Ç–æ—Ä–Ω–∏–∫</option>
      <option value="3">–°—Ä–µ–¥–∞</option>
      <option value="4">–ß–µ—Ç–≤–µ—Ä–≥</option>
      <option value="5">–ü—è—Ç–Ω–∏—Ü–∞</option>
      <option value="6">–°—É–±–±–æ—Ç–∞</option>
      <option value="0">–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ</option>
    </select>
    <div class="form-buttons">
      <button class="save-btn" id="saveDayBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button class="cancel-btn" id="cancelDayBtn">‚ùå –û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
  
  <hr>

  <h2>–†–µ–¥–∞–∫—Ç–æ—Ä —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</h2>
  <div id="daySelector"></div>
  <button id="addExerciseBtn">+ –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</button>
  
  <div id="exerciseEditForm" class="edit-form">
    <label>–ù–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è:</label>
    <input type="text" id="exerciseNameInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ñ–∏–º –ª—ë–∂–∞">
    <label>–ü–æ–¥—Ö–æ–¥—ã:</label>
    <input type="number" id="exerciseSetsInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 4" min="1">
    <label>–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è:</label>
    <input type="text" id="exerciseRepsInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 8-10">
    <div class="checkbox-wrapper">
      <input type="checkbox" id="exerciseHasWeightInput">
      <label for="exerciseHasWeightInput">–ï—Å—Ç—å –≤–µ—Å</label>
    </div>
    <div class="form-buttons">
      <button class="save-btn" id="saveExerciseBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button class="cancel-btn" id="cancelExerciseBtn">‚ùå –û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
  
  <ul id="exerciseEditorList" class="editable-list"></ul>
  <hr>

</div>

  <h1>–ü–ª–∞–Ω –†–æ—Å—Ç–∞ (12 –Ω–µ–¥–µ–ª—å)</h1>

  <h2>–ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞ –Ω–µ–¥–µ–ª—é</h2>
  <div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>

  <div id="dynamicTrainingDays"></div>

</div>

<!-- NUTRITION -->
<div id="nutrition" class="container">
  <h1>–ü–∏—Ç–∞–Ω–∏–µ</h1>

  <button id="editNutritionBtn" class="edit-section-btn">‚úè –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>

  <textarea id="nutritionText" style="width:100%; min-height:180px; padding:12px; border-radius:8px; border:1px solid #aaa; font-size:1em; resize:vertical; display:none; background: var(--bg); color: var(--fg);"></textarea>

  <div id="nutritionView" style="white-space:pre-wrap; background: var(--day-bg); padding:14px; border-radius:8px;"></div>
</div>

<!-- SUPPLEMENTS -->
<div id="supplements" class="container">
  <h1>–î–æ–±–∞–≤–∫–∏</h1>

  <button id="editSupplementsBtn" class="edit-section-btn">‚úè –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>

  <div class="supplement-section">
    <h3>üåÖ –ó–∞–≤—Ç—Ä–∞–∫</h3>
    <textarea id="supplementBreakfastText" class="supplement-textarea"></textarea>
    <div id="supplementBreakfastView" class="supplement-view"></div>
  </div>

  <div class="supplement-section">
    <h3>üçΩ –û–±–µ–¥</h3>
    <textarea id="supplementLunchText" class="supplement-textarea"></textarea>
    <div id="supplementLunchView" class="supplement-view"></div>
  </div>

  <div class="supplement-section">
    <h3>üç¥ –£–∂–∏–Ω</h3>
    <textarea id="supplementDinnerText" class="supplement-textarea"></textarea>
    <div id="supplementDinnerView" class="supplement-view"></div>
  </div>

  <div class="supplement-section">
    <h3>üí™ –ü–µ—Ä–µ–¥ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–æ–π</h3>
    <textarea id="supplementPreWorkoutText" class="supplement-textarea"></textarea>
    <div id="supplementPreWorkoutView" class="supplement-view"></div>
  </div>

  <div class="supplement-section">
    <h3>üèãÔ∏è –ü–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</h3>
    <textarea id="supplementPostWorkoutText" class="supplement-textarea"></textarea>
    <div id="supplementPostWorkoutView" class="supplement-view"></div>
  </div>

</div>

<!-- STATS -->
<div id="stats" class="container">
  <h1>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h1>
<div style="margin:10px 0; display:flex; gap:10px; flex-wrap:wrap;">
  <button onclick="resetAllStats()" class="del-btn">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
</div>
<div style="margin:15px 0;">
  <button onclick="showStatsMode('week')" class="edit-btn" id="weekStatsBtn">üìÖ –ü–æ –Ω–µ–¥–µ–ª—è–º</button>
  <button onclick="showStatsMode('total')" class="edit-btn" id="totalStatsBtn">üìä –û–±—â–∞—è</button>
</div>
  <label>
    –ù–µ–¥–µ–ª—è:
    <select id="statsWeekSelect"></select>
  </label>

  <div id="weekSummary"></div>
  <div id="totalStats" style="display:none;"></div>

  <h3>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –∑–∞ –Ω–µ–¥–µ–ª—é</h3>
  <div id="rpeStats"></div>
</div>

</div>

<script src="app.js"></script>
<script>
// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js')
    .then(reg => console.log('‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', reg))
    .catch(err => console.error('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', err));
}
</script>

</body>
</html>
